<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>投資組合評估</title>
    <style>
        /* ****** 顏色與陰影變量 (全白色 Claymorphism 精確設定) ****** */
        :root {
            --bg-color: #F0F0F0; /* 略微偏灰，作為主體背景 */
            --main-color: #FFFFFF; /* 卡片和主要元素顏色 */
            --input-bg: #EBEBEB; /* 輸入框的淺凹陷背景 */
            --text-primary: #333333;
            --text-secondary: #777777;

            /* 統一使用淺灰色陰影和白色高光來營造白色 Clay 效果 */
            --shadow-light: 6px 6px 12px rgba(255, 255, 255, 1), -6px -6px 12px rgba(180, 180, 180, 0.5); /* 凸起陰影 */
            --shadow-dark: 4px 4px 8px rgba(180, 180, 180, 0.4), -4px -4px 8px rgba(255, 255, 255, 0.8); /* 凸起陰影 (用於按鈕) */
            --inner-shadow: inset 3px 3px 6px rgba(180, 180, 180, 0.4), inset -3px -3px 6px rgba(255, 255, 255, 0.6); /* 凹陷陰影 */
            
            --btn-calc-color: #FF8F4A; /* 保持突出的橙色 */
            --btn-calc-shadow: 0 8px 16px rgba(255, 143, 74, 0.4); 
            --active-color: #3867D6; /* 保持藍色活躍狀態 */

            /* 狀態卡片背景顏色全部使用白色，並調整文字顏色以保持可讀性 */
            --success-color: #FFFFFF; 
            --warning-color: #FFFFFF; 
            --info-color: #FFFFFF;
            --action-color: #FFFFFF; 
            
            /* 狀態文字顏色保持不變 */
            --success-text: #38a169;
            --warning-text: #e53e3e;
            --info-text: #3867D6;
            --action-text: #dd6b20;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color); 
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            color: var(--text-primary);
        }

        /* ************************************************* */
        /* ****** 主要修改部分：全寬度手機適配與取消外框 ****** */
        /* ************************************************* */
        .container {
            background: var(--main-color); /* 主體背景設為純白 */
            padding: 30px 25px;
            border-radius: 0;
            box-shadow: none; /* 容器無陰影 */
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        /* ************************************************* */
        
        h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 30px;
            color: var(--text-primary);
        }
        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* ------------------------------------- */
        /* 輸入框風格 (凹陷設計) */
        /* ------------------------------------- */
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 18px;
            font-size: 1rem;
            background-color: var(--input-bg); /* 使用淺灰作為凹陷背景 */
            box-sizing: border-box;
            outline: none;
            box-shadow: var(--inner-shadow); /* 使用內陰影創造凹陷感 */
            transition: all 0.3s ease; 
            color: var(--text-primary);
            margin-bottom: 20px;
        }
        input[type="number"]:focus, input[type="text"]:focus {
            background-color: #E0E0E0; /* 略深一點的凹陷效果 */
            transform: scale(1.01); 
        }

        /* ------------------------------------- */
        /* 比例選擇按鈕 (凸起/凹陷狀態) */
        /* ------------------------------------- */
        .config-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px;
            margin-bottom: 25px;
        }
        .config-buttons button {
            padding: 14px 10px;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease; 
            color: var(--text-primary);
            background: var(--main-color); /* 純白背景 */
            box-shadow: var(--shadow-dark); /* 淺色凸起陰影 */
        }
        .config-buttons button:hover:not(.active) {
            transform: translateY(-2px); 
            box-shadow: 4px 4px 8px rgba(180, 180, 180, 0.6), -4px -4px 8px rgba(255, 255, 255, 0.9);
        }
        /* 激活狀態：深色凹陷 (保留顏色以區分) */
        .config-buttons button.active {
            background-color: var(--active-color);
            color: white;
            box-shadow: inset 3px 3px 6px rgba(0, 0, 0, 0.2), inset -3px -3px 6px rgba(255, 255, 255, 0.2); 
            transform: scale(1.0);
        }
        
        /* ------------------------------------- */
        /* 主要計算按鈕 (糖果橙 3D 質感) */
        /* ------------------------------------- */
        button#calculate-btn {
            width: 100%;
            padding: 18px;
            background-color: var(--btn-calc-color); 
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            margin-top: 25px;
            box-shadow: var(--btn-calc-shadow); 
            transition: all 0.2s ease;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        }
        button#calculate-btn:hover {
            opacity: 0.95;
            box-shadow: 0 10px 20px rgba(255, 143, 74, 0.6); 
        }
        button#calculate-btn:active {
            box-shadow: 0 3px 10px rgba(255, 143, 74, 0.6); 
            transform: translateY(3px); 
        }

        /* ------------------------------------- */
        /* 結果展示 (卡片風格更新為白色 Clay) */
        /* ------------------------------------- */
        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .result-panel {
            margin-top: 35px;
            padding-top: 20px;
            border-top: 1px solid rgba(180, 180, 180, 0.3);
            display: none; 
            animation: fadeInSlide 0.6s ease-out forwards; 
        }
        
        /* 狀態/建議卡片風格 (全部白色，用深色邊框和文字顏色區分) */
        .status-box, .action-steps, .dca-advice {
            transition: box-shadow 0.3s ease;
            border: 1px solid #E0E0E0; /* 增加淺色邊框以在白色背景上區分 */
            border-radius: 20px;
            margin-top: 15px;
            padding: 20px;
            font-weight: 600;
            background-color: var(--main-color); /* 純白背景 */
            box-shadow: var(--shadow-dark); /* 凸起效果 */
        }
        .status-ok { color: var(--success-text); border-left: 5px solid var(--success-text); }
        .status-warn { color: var(--warning-text); border-left: 5px solid var(--warning-text); }
        .action-steps { color: var(--info-text); border-left: 5px solid var(--info-text); }
        .dca-advice { color: var(--action-text); border-left: 5px solid var(--action-text); }


        /* ------------------------------------- */
        /* 其餘靜態樣式保持不變 */
        /* ------------------------------------- */

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-dark); /* 表格整體凸起 */
        }
        .summary-table th, .summary-table td {
            text-align: left;
            padding: 15px;
            font-size: 0.95rem;
            background-color: var(--main-color);
            border-bottom: 1px solid var(--input-bg);
        }
        .summary-table th {
            background-color: var(--input-bg); /* 表頭使用淺灰，略微區分 */
            color: var(--text-primary);
        }
        
        /* 手機上兩欄輸入保持 */
        .asset-config-row { display: flex; gap: 15px; }
        .asset-config-row > div { flex: 1; }
        
        /* 針對 label 與 input 的間距調整 */
        .input-group { margin-bottom: 5px; } 

        .note { font-size: 0.8rem; color: var(--text-secondary); margin-top: 30px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h2>投資組合評估</h2>
    
    <div class="input-group">
        <label>設定目標比例</label>
        <div class="config-buttons">
            <button id="btn-80-20" class="active" onclick="setTarget(80, 20)">80% / 20%</button>
            <button id="btn-70-30" onclick="setTarget(70, 30)">70% / 30%</button>
            <button id="btn-60-40" onclick="setTarget(60, 40)">60% / 40%</button>
            <button id="btn-50-50" onclick="setTarget(50, 50)">50% / 50%</button>
        </div>
    </div>

    <div class="asset-config-row">
        <div class="input-group">
            <label for="assetAName">核心資產:</label>
            <input type="text" id="assetAName" value="QQQ" placeholder="例如: VOO, QQQ">
        </div>
        <div class="input-group">
            <label for="assetBName">衛星資產:</label>
            <input type="text" id="assetBName" placeholder="請輸入 (例如: BND, JEPI)">
        </div>
    </div>

    <div class="input-group">
        <label for="tolerance">容忍度 (%)</label>
        <input type="number" id="tolerance" value="5" placeholder="例如: 5 (代表 ±5%)">
    </div>

    <div class="asset-config-row">
        <div class="input-group">
            <label id="assetALabel" for="qqqVal">QQQ 當前市值 (K 美元)</label>
            <input type="number" id="qqqVal" placeholder="例如: 8.50">
        </div>
        <div class="input-group">
            <label id="assetBLabel" for="jepiVal">請輸入 當前市值 (K 美元)</label>
            <input type="number" id="jepiVal" placeholder="例如: 1.50">
        </div>
    </div>
    
    <div class="input-group">
        <label for="dcaAmount">每月供款金額 (K 美元)</label>
        <input type="number" id="dcaAmount" placeholder="例如: 0.50 (即 $500)">
    </div>

    <button id="calculate-btn" onclick="calculate()">執行計算與評估</button>

    <div id="resultPanel" class="result-panel">
        <h3 style="font-size: 1.3rem; margin-top: 0; color: var(--text-primary);">組合狀況概要</h3>

        <table class="summary-table">
            <thead>
                <tr>
                    <th>資產</th>
                    <th>市值 (K 美元)</th>
                    <th>比例</th>
                    <th>目標</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="resAssetNameA">QQQ</td>
                    <td id="resQQQVal" class="highlight">-</td>
                    <td id="resQQQPct">-</td>
                    <td id="resTargetA">80% (±5%)</td>
                </tr>
                <tr>
                    <td id="resAssetNameB">請輸入</td>
                    <td id="resJEPIVal" class="highlight">-</td>
                    <td id="resJEPIPct">-</td>
                    <td id="resTargetB">20% (±5%)</td>
                </tr>
                <tr>
                    <td class="highlight">總資產</td>
                    <td id="resTotal" class="highlight" colspan="3">-</td>
                </tr>
            </tbody>
        </table>

        <div id="statusBox" class="status-box"></div>
        <div id="dcaAdvice" class="dca-advice"></div>
        <div id="actionSteps" class="action-steps" style="display:none;"></div>
    </div>
    
    <div class="note">所有金額以 K 美元 (千美元) 計算。</div>
</div>

<script>
    // JS Logic (保持不變)
    let targetA_pct = 80;
    let targetB_pct = 20;

    function setTarget(A, B) {
        targetA_pct = A;
        targetB_pct = B;
        
        document.getElementById('btn-80-20').classList.toggle('active', A === 80);
        document.getElementById('btn-70-30').classList.toggle('active', A === 70);
        document.getElementById('btn-60-40').classList.toggle('active', A === 60);
        document.getElementById('btn-50-50').classList.toggle('active', A === 50);

        const tolerance = parseFloat(document.getElementById('tolerance').value) || 5;
        document.getElementById('resTargetA').innerText = `${targetA_pct}% (±${tolerance}%)`;
        document.getElementById('resTargetB').innerText = `${targetB_pct}% (±${tolerance}%)`;
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        setTarget(80, 20);
    });

    function calculate() {
        const assetAName = document.getElementById('assetAName').value.toUpperCase().trim() || 'Asset A';
        const assetBName = document.getElementById('assetBName').value.toUpperCase().trim() || 'Asset B';
        const tolerance = parseFloat(document.getElementById('tolerance').value) || 5;
        
        const qqqVal = parseFloat(document.getElementById('qqqVal').value) || 0;
        const jepiVal = parseFloat(document.getElementById('jepiVal').value) || 0;
        const dcaAmount = parseFloat(document.getElementById('dcaAmount').value) || 0;
        
        const totalVal = qqqVal + jepiVal;

        if (totalVal <= 0) {
            alert("總資產必須大於 0 才能計算比例");
            return;
        }

        const minA = targetA_pct - tolerance;
        const maxA = targetA_pct + tolerance;
        
        document.getElementById('assetALabel').innerText = `${assetAName} 當前市值 (K 美元)`;
        document.getElementById('assetBLabel').innerText = `${assetBName} 當前市值 (K 美元)`;
        document.getElementById('resAssetNameA').innerText = assetAName;
        document.getElementById('resAssetNameB').innerText = assetBName;
        document.getElementById('resTargetA').innerText = `${targetA_pct}% (±${tolerance}%)`;
        document.getElementById('resTargetB').innerText = `${targetB_pct}% (±${tolerance}%)`;

        const assetAPct = (qqqVal / totalVal) * 100;
        
        // 輸出結果格式：數值在前，K 美元在後
        document.getElementById('resQQQVal').innerText = `${qqqVal.toFixed(2)} K 美元`;
        document.getElementById('resQQQPct').innerText = `${assetAPct.toFixed(2)}%`;
        document.getElementById('resJEPIVal').innerText = `${jepiVal.toFixed(2)} K 美元`;
        document.getElementById('resJEPIPct').innerText = `${(100 - assetAPct).toFixed(2)}%`;
        document.getElementById('resTotal').innerText = `${totalVal.toFixed(2)} K 美元`;

        // ********** 動畫邏輯更新 **********
        const resultPanel = document.getElementById('resultPanel');
        resultPanel.style.display = "none"; 
        void resultPanel.offsetWidth; 
        resultPanel.style.display = "block"; 
        // **********************************

        const statusBox = document.getElementById('statusBox');
        const actionSteps = document.getElementById('actionSteps');
        const dcaAdvice = document.getElementById('dcaAdvice');
        
        let needsRebalance = false;
        let message = "";
        
        if (assetAPct > maxA) {
            needsRebalance = true;
            message = ` ${assetAName} 佔比過高 (${assetAPct.toFixed(2)}% > ${maxA}%)，已達到觸發點。`;
            statusBox.className = "status-box status-warn";
        } else if (assetAPct < minA) {
            needsRebalance = true;
            message = ` ${assetAName} 佔比過低 (${assetAPct.toFixed(2)}% < ${minA}%)，已達到觸發點。`;
            statusBox.className = "status-box status-warn";
        } else {
            message = " 投資組合比例健康，無需調整現有倉位。";
            statusBox.className = "status-box status-ok";
        }
        
        statusBox.innerText = message.trim(); 

        // --- 傳統再平衡建議 ---
        if (needsRebalance) {
            actionSteps.style.display = "block";
            
            const targetA = totalVal * (targetA_pct / 100);
            const diffA = targetA - qqqVal; 
            const diffB = -diffA; 
            
            const buyColor = 'var(--active-color)'; 
            const sellColor = '#c53030'; 

            // 輸出結果格式：數值在前，K 美元在後
            const assetAAct = diffA > 0 ? `<span style="color:${buyColor}">買入 ${Math.abs(diffA).toFixed(2)} K 美元</span>` : `<span style="color:${sellColor}">賣出 ${Math.abs(diffA).toFixed(2)} K 美元</span>`;
            const assetBAct = diffB > 0 ? `<span style="color:${buyColor}">買入 ${Math.abs(diffB).toFixed(2)} K 美元</span>` : `<span style="color:${sellColor}">賣出 ${Math.abs(diffB).toFixed(2)} K 美元</span>`;

            actionSteps.innerHTML = `
                <strong>傳統再平衡建議 (倉位調整)：</strong><br>
                為了達到 ${targetA_pct}/${targetB_pct} 比例，您需要執行以下操作：<br>
                1. ${assetAName}: ${assetAAct}<br>
                2. ${assetBName}: ${assetBAct}
            `;
        } else {
            actionSteps.style.display = "none";
        }

        // --- 月供分配建議 ---
        let dcaMsg = "";

        if (dcaAmount > 0) {
            if (needsRebalance) {
                if (assetAPct > targetA_pct) {
                    dcaMsg = `
                        <strong>月供建議 (修正模式)：</strong><br>
                        由於 ${assetAName} 嚴重超重，建議將 **100%** (${dcaAmount.toFixed(2)} K 美元) 的月供全部投入：
                        <br> ➡️ **${assetBName}**
                        <br><small>直至整體組合比例回到 ${targetA_pct}/${targetB_pct} 範圍為止。</small>
                    `;
                } else if (assetAPct < targetA_pct) { 
                     dcaMsg = `
                        <strong>月供建議 (修正模式)：</strong><br>
                        由於 ${assetAName} 嚴重不足，建議將 **100%** (${dcaAmount.toFixed(2)} K 美元) 的月供全部投入：
                        <br> ➡️ **${assetAName}**
                        <br><small>直至整體組合比例回到 ${targetA_pct}/${targetB_pct} 範圍為止。</small>
                    `;
                }
            } else {
                const dcaA = dcaAmount * (targetA_pct / 100);
                const dcaB = dcaAmount * (targetB_pct / 100);
                // 輸出結果格式：數值在前，K 美元在後
                dcaMsg = `
                    <strong>月供建議 (正常模式)：</strong><br>
                    目前的倉位比例健康，建議月供按目標 ${targetA_pct}/${targetB_pct} 比例分配：
                    <br> ➡️ ${assetAName} ${targetA_pct}% (${dcaA.toFixed(2)} K 美元)
                    <br> ➡️ ${assetBName} ${targetB_pct}% (${dcaB.toFixed(2)} K 美元)
                `;
            }
        } else {
            dcaMsg = "請輸入「每月供款金額 (K 美元)」以獲取月供分配建議。";
        }

        dcaAdvice.innerHTML = dcaMsg;
    }
</script>

</body>
</html>