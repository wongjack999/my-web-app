<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>投資組合評估 - 黑白金屬儀表板 (簡化)</title>
    <style>
        /* ****** 黑白 Duotone 變量 ****** */
        :root {
            /* 主體顏色與光暈 (黑白灰) */
            --bg-color: #EFEFEF; /* 背景 (淺灰) */
            --main-color: #FAFAFA; /* 主體卡片 (接近白) */
            --metal-light: #D5D5D5; /* 淺金屬色/高光 */
            --metal-dark: #333333; /* 深金屬色/活躍色 */
            --text-primary: #111111;
            --text-secondary: #666666;

            /* Neumorphism 陰影 (純黑白，增加對比度模擬金屬硬朗感) */
            --shadow-light: 5px 5px 10px rgba(0, 0, 0, 0.15), -5px -5px 10px rgba(255, 255, 255, 1);
            --shadow-dark: 3px 3px 6px rgba(0, 0, 0, 0.2), -3px -3px 6px rgba(255, 255, 255, 0.8);
            --inner-shadow-dark: inset 3px 3px 6px rgba(0, 0, 0, 0.3), inset -3px -3px 6px rgba(255, 255, 255, 0.1); /* 深凹陷 */

            /* LCD 顯示屏顏色 (黑底白字) */
            --screen-bg: #1A1A1A; /* 深黑 */
            --screen-text: #FFFFFF; /* 純白高亮數字 */
            --screen-label: #AAAAAA; /* 淺灰標籤 */

            /* 按鈕與活躍色 (僅使用黑灰) */
            --btn-control-color: #E0E0E0;
            --btn-calc-color: var(--metal-dark); /* 計算按鈕使用深黑金屬色 */
            --btn-calc-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); 
            --active-color: #555555; /* 比例活躍狀態 (中灰) */
            
            /* 狀態顏色 (用深色邊框和強烈文字顏色區分) */
            --status-ok-border: #000000;
            --status-warn-border: #CC0000;
            --action-border: #666666;
            --dca-border: #333333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color); 
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* ------------------------------------- */
        /* 主容器與外框模擬 (硬朗金屬外殼) */
        /* ------------------------------------- */
        .container {
            background: var(--main-color);
            padding: 20px 25px 40px;
            border-radius: 0px;
            box-shadow: var(--shadow-light); 
            width: 100%;
            max-width: 450px;
            box-sizing: border-box;
            position: relative;
            z-index: 1;
            border: 0px solid var(--metal-light); /* 增加硬朗邊框 */
        }

        h2 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--text-primary);
            text-align: center;
        }
        
        /* ------------------------------------- */
        /* LCD 儀表顯示區 (頂部 - 黑底白字) */
        /* ------------------------------------- */
        .screen-display {
            background-color: var(--screen-bg);
            color: var(--screen-text);
            padding: 20px 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.6);
            font-family: monospace;
            text-align: center;
            border: 1px solid #000;
        }
        .screen-display .main-value {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
            margin: 0 0 5px 0;
            color: var(--screen-text);
        }
        .screen-display .label {
            font-size: 0.85rem;
            color: var(--screen-label);
            display: block;
            margin-bottom: 10px; 
        }
        .screen-display .sub-info {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            font-size: 0.8rem;
            color: var(--screen-label);
        }
        .screen-display .percentage {
             font-size: 1.2rem;
             color: var(--screen-text); 
             font-weight: bold;
        }

        /* ------------------------------------- */
        /* 輸入框組件 (整合資產名稱與市值) */
        /* ------------------------------------- */
        .asset-input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-item {
            flex: 1;
        }

        .input-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* 新增的整合輸入框樣式 */
        .asset-input {
            width: 100%;
            display: flex;
            border-radius: 10px;
            box-sizing: border-box;
            box-shadow: var(--inner-shadow-dark);
            background-color: var(--main-color);
            transition: all 0.3s ease;
            overflow: hidden;
            height: 44px; /* 固定高度 */
        }
        
        .asset-input input[type="text"] {
            flex-grow: 1;
            padding: 12px 0 12px 15px;
            border: none;
            font-size: 1rem;
            background: none;
            color: var(--text-primary);
            box-sizing: border-box;
            outline: none;
            box-shadow: none; /* 移除內部陰影 */
            margin-bottom: 0;
            border-right: 1px solid var(--metal-light);
        }

        .asset-input input[type="number"] {
            width: 100px; /* 市值欄位固定寬度 */
            padding: 12px 15px 12px 10px;
            border: none;
            font-size: 1rem;
            background: none;
            color: var(--text-primary);
            box-sizing: border-box;
            outline: none;
            box-shadow: none; /* 移除內部陰影 */
            text-align: right;
            margin-bottom: 0;
        }

        .asset-input input:focus {
             background-color: var(--metal-light);
        }
        
        /* 獨立的數字輸入框 (如月供) */
        input.standard-input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            background-color: var(--main-color);
            box-sizing: border-box;
            outline: none;
            box-shadow: var(--inner-shadow-dark); /* 深色凹槽，對比強烈 */
            transition: all 0.3s ease; 
            color: var(--text-primary);
            margin-bottom: 20px;
        }
        input.standard-input[type="number"]:focus {
            background-color: var(--metal-light);
        }

        /* ------------------------------------- */
        /* 比例選擇按鈕 (凸起金屬按鈕) */
        /* ------------------------------------- */
        .config-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px;
            margin-bottom: 25px;
        }
        .config-buttons button {
            padding: 12px 10px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease; 
            color: var(--text-primary);
            background: var(--btn-control-color); 
            box-shadow: var(--shadow-dark); 
            border: 1px solid var(--metal-light);
        }
        /* 激活狀態：深色凹陷 (中灰) */
        .config-buttons button.active {
            background-color: var(--active-color);
            color: white;
            box-shadow: var(--inner-shadow-dark); 
            transform: scale(0.98);
        }
        
        /* ------------------------------------- */
        /* 主要計算按鈕 (深黑金屬控制鍵) */
        /* ------------------------------------- */
        button#calculate-btn {
            width: 100%;
            padding: 18px;
            background-color: var(--btn-calc-color); 
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            margin-top: 25px;
            box-shadow: var(--btn-calc-shadow); 
            transition: all 0.2s ease;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.4);
        }
        button#calculate-btn:active {
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4), var(--inner-shadow-dark); 
            transform: translateY(2px); 
        }

        /* ------------------------------------- */
        /* 結果展示 (表格與卡片) */
        /* ------------------------------------- */
        .result-panel {
            margin-top: 35px;
            padding-top: 20px;
            border-top: 1px solid var(--metal-light);
            display: none; 
            animation: fadeInSlide 0.6s ease-out forwards; 
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow-dark); 
            background-color: var(--main-color);
        }
        .summary-table th, .summary-table td {
            text-align: left;
            padding: 12px;
            font-size: 0.95rem;
            background-color: var(--main-color);
            border-bottom: 1px solid var(--metal-light);
        }
        .summary-table th {
            background-color: var(--btn-control-color);
            color: var(--text-primary);
            font-weight: 600;
        }
        
        /* 結果卡片 (模擬狀態燈 - 僅用黑白灰) */
        .status-box, .action-steps, .dca-advice {
            transition: box-shadow 0.3s ease;
            border-radius: 10px;
            margin-top: 15px;
            padding: 15px;
            font-weight: 500;
            background-color: var(--main-color);
            box-shadow: var(--shadow-dark); 
            border: 1px solid var(--metal-light);
            font-size: 0.95rem;
        }
        .status-box strong, .dca-advice strong {
            display: block;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        /* 狀態顏色 (用深色邊框和強烈文字顏色區分) */
        .status-ok { 
            color: #111111; 
            border-left: 5px solid var(--status-ok-border); /* 純黑邊框 */
        }
        .status-warn { 
            color: #CC0000; /* 保留警告色為深紅色，作為唯一的非灰/黑/白突出色 */
            border-left: 5px solid var(--status-warn-border); 
        }
        .action-steps { 
            color: #000000; 
            border-left: 5px solid var(--action-border);
        }
        .dca-advice { 
            color: #333333; 
            border-left: 5px solid var(--dca-border);
        }
        
        .note { font-size: 0.8rem; color: var(--text-secondary); margin-top: 30px; text-align: center; }

        @keyframes fadeInSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>投資組合再平衡 (簡化)</h2>
    
    <div id="top-display" class="screen-display">
        <span class="label">當前總資產 (K 美元) / 核心資產目標比例</span>
        <div class="main-value" id="resTotalDisplay">0.00</div>
        <div class="sub-info">
            <span>核心資產 (<span id="resAssetNameA_short">A</span>) 比例:</span> 
            <span class="percentage" id="resAssetAPctDisplay">0.00%</span>
        </div>
    </div>

    <div class="input-group">
        <label>設定目標比例 (核心 / 衛星)</label>
        <div class="config-buttons">
            <button id="btn-80-20" class="active" onclick="setTarget(80, 20)">80% / 20%</button>
            <button id="btn-70-30" onclick="setTarget(70, 30)">70% / 30%</button>
            <button id="btn-60-40" onclick="setTarget(60, 40)">60% / 40%</button>
            <button id="btn-50-50" onclick="setTarget(50, 50)">50% / 50%</button>
        </div>
    </div>
    
    <div class="input-item">
        <label for="assetAName">核心資產名稱與市值 (K 美元)</label>
        <div class="asset-input">
            <input type="text" id="assetAName" value="QQQ" placeholder="資產代號, 例如: VOO">
            <input type="number" id="assetAVal" placeholder="例如: 8.50">
        </div>
    </div>

    <div class="input-item">
        <label for="assetBName">衛星資產名稱與市值 (K 美元)</label>
        <div class="asset-input">
            <input type="text" id="assetBName" value="BND" placeholder="資產代號, 例如: BND">
            <input type="number" id="assetBVal" placeholder="例如: 1.50">
        </div>
    </div>

    <div class="input-group">
        <label for="dcaAmount">每月供款金額 (K 美元)</label>
        <input type="number" id="dcaAmount" class="standard-input" placeholder="例如: 0.50 (即 $500)">
    </div>

    <button id="calculate-btn" onclick="calculate()">執行評估</button>

    <div id="resultPanel" class="result-panel">
        <h3 style="font-size: 1.3rem; margin-top: 0; color: var(--text-primary);">組合狀況概要</h3>

        <table class="summary-table">
            <thead>
                <tr>
                    <th>資產</th>
                    <th>市值 (K 美元)</th>
                    <th>比例</th>
                    <th>目標比例</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="resAssetNameA">QQQ</td>
                    <td id="resAssetAVal">-</td>
                    <td id="resAssetAPct">-</td>
                    <td id="resTargetA">80%</td>
                </tr>
                <tr>
                    <td id="resAssetNameB">BND</td>
                    <td id="resAssetBVal">-</td>
                    <td id="resAssetBPct">-</td>
                    <td id="resTargetB">20%</td>
                </tr>
                <tr>
                    <td style="font-weight: 700;">總資產</td>
                    <td id="resTotal" colspan="3" style="font-weight: 700;">-</td>
                </tr>
            </tbody>
        </table>

        <div id="statusBox" class="status-box"></div>
        <div id="actionSteps" class="action-steps" style="display:none;"></div>
        <div id="dcaAdvice" class="dca-advice"></div>
    </div>
    
</div>

<script>
    let targetA_pct = 80;
    let targetB_pct = 20;

    function setTarget(A, B) {
        targetA_pct = A;
        targetB_pct = B;
        
        document.getElementById('btn-80-20').classList.toggle('active', A === 80);
        document.getElementById('btn-70-30').classList.toggle('active', A === 70);
        document.getElementById('btn-60-40').classList.toggle('active', A === 60);
        document.getElementById('btn-50-50').classList.toggle('active', A === 50);

        // 移除容忍度顯示
        document.getElementById('resTargetA').innerText = `${targetA_pct}%`;
        document.getElementById('resTargetB').innerText = `${targetB_pct}%`;
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        // 確保初始資產名稱顯示正確
        const assetAName = document.getElementById('assetAName').value.toUpperCase().trim() || 'Asset A';
        const assetBName = document.getElementById('assetBName').value.toUpperCase().trim() || 'Asset B';
        document.getElementById('resAssetNameA_short').innerText = assetAName;
        document.getElementById('resAssetNameA').innerText = assetAName;
        document.getElementById('resAssetNameB').innerText = assetBName;

        setTarget(80, 20);
        document.getElementById('resTotalDisplay').innerText = '0.00';
        document.getElementById('resAssetAPctDisplay').innerText = '0.00%';
    });

    function calculate() {
        const assetAName = document.getElementById('assetAName').value.toUpperCase().trim() || 'Asset A';
        const assetBName = document.getElementById('assetBName').value.toUpperCase().trim() || 'Asset B';
        // 容忍度取消，固定為 5% 作為再平衡的「觸發點」 (Internal Logic)
        const tolerance = 5; 
        
        const assetAVal = parseFloat(document.getElementById('assetAVal').value) || 0;
        const assetBVal = parseFloat(document.getElementById('assetBVal').value) || 0;
        const dcaAmount = parseFloat(document.getElementById('dcaAmount').value) || 0;
        
        const totalVal = assetAVal + assetBVal;

        if (totalVal <= 0) {
            document.getElementById('resTotalDisplay').innerText = 'ERROR';
            document.getElementById('resAssetAPctDisplay').innerText = 'N/A';
            document.getElementById('resultPanel').style.display = "none";
            alert("總資產必須大於 0 才能計算比例");
            return;
        }

        const minA = targetA_pct - tolerance;
        const maxA = targetA_pct + tolerance;
        
        // 更新 UI 標籤與結果欄位
        document.getElementById('resAssetNameA').innerText = assetAName;
        document.getElementById('resAssetNameA_short').innerText = assetAName;
        document.getElementById('resAssetNameB').innerText = assetBName;
        document.getElementById('resTargetA').innerText = `${targetA_pct}%`;
        document.getElementById('resTargetB').innerText = `${targetB_pct}%`;

        const assetAPct = (assetAVal / totalVal) * 100;
        const assetBPct = 100 - assetAPct;
        
        // 輸出結果格式
        document.getElementById('resAssetAVal').innerText = `${assetAVal.toFixed(2)} K 美元`;
        document.getElementById('resAssetAPct').innerText = `${assetAPct.toFixed(2)}%`;
        document.getElementById('resAssetBVal').innerText = `${assetBVal.toFixed(2)} K 美元`;
        document.getElementById('resAssetBPct').innerText = `${assetBPct.toFixed(2)}%`;
        document.getElementById('resTotal').innerText = `${totalVal.toFixed(2)} K 美元`;

        // 更新頂部儀表盤
        document.getElementById('resTotalDisplay').innerText = `${totalVal.toFixed(2)}`;
        document.getElementById('resAssetAPctDisplay').innerText = `${assetAPct.toFixed(2)}%`;


        // ********** 動畫邏輯更新 **********
        const resultPanel = document.getElementById('resultPanel');
        resultPanel.style.display = "none"; 
        void resultPanel.offsetWidth; 
        resultPanel.style.display = "block"; 
        // **********************************

        const statusBox = document.getElementById('statusBox');
        const actionSteps = document.getElementById('actionSteps');
        const dcaAdvice = document.getElementById('dcaAdvice');
        
        let needsRebalance = false;
        let message = "";
        
        if (assetAPct > maxA) {
            needsRebalance = true;
            message = ` **比例警告** ${assetAName} 佔比嚴重過高 (${assetAPct.toFixed(2)}% > ${maxA}%)，建議立即再平衡。`;
            statusBox.className = "status-box status-warn";
        } else if (assetAPct < minA) {
            needsRebalance = true;
            message = ` **比例警告** ${assetAName} 佔比嚴重不足 (${assetAPct.toFixed(2)}% < ${minA}%)，建議立即再平衡。`;
            statusBox.className = "status-box status-warn";
        } else {
            message = " **比例健康** 投資組合比例在設定容忍度範圍內。";
            statusBox.className = "status-box status-ok";
        }
        
        statusBox.innerHTML = message.trim(); 

        // --- 傳統再平衡建議 ---
        if (needsRebalance) {
            actionSteps.style.display = "block";
            
            const targetA = totalVal * (targetA_pct / 100);
            const diffA = targetA - assetAVal; 
            const diffB = -diffA; 
            
            const buyColor = '#000000'; 
            const sellColor = '#CC0000'; 

            // 輸出結果格式：數值在前，K 美元在後
            const assetAAct = diffA > 0 ? `<span style="color:${buyColor}; font-weight: 700;">買入 ${Math.abs(diffA).toFixed(2)} K 美元</span>` : `<span style="color:${sellColor}; font-weight: 700;">賣出 ${Math.abs(diffA).toFixed(2)} K 美元</span>`;
            const assetBAct = diffB > 0 ? `<span style="color:${buyColor}; font-weight: 700;">買入 ${Math.abs(diffB).toFixed(2)} K 美元</span>` : `<span style="color:${sellColor}; font-weight: 700;">賣出 ${Math.abs(diffB).toFixed(2)} K 美元</span>`;

            actionSteps.innerHTML = `
                <strong>【再平衡操作】</strong><br>
                為咗達到 ${targetA_pct}/${targetB_pct} 比例，你需要執行以下倉位調整：<br>
                1. ${assetAName}: ${assetAAct}<br>
                2. ${assetBName}: ${assetBAct}
                `;
        } else {
            actionSteps.style.display = "none";
        }

        // --- 月供分配建議 ---
        let dcaMsg = "";

        if (dcaAmount > 0) {
            if (needsRebalance) {
                // 如果需要再平衡，月供全部投入不足的資產，以修正偏差 (DCA Rebalancing Method)
                let underWeightAsset = (assetAPct < targetA_pct) ? assetAName : assetBName;
                
                // 額外檢查：如果月供能修正偏差，則建議 100% 投入
                dcaMsg = `
                    <strong>【月供建議 - 修正】</strong><br>
                    由於倉位嚴重偏離目標，建議將 **100%** (${dcaAmount.toFixed(2)} K 美元) 的月供全部投入：
                    <br> ➡️ **${underWeightAsset}**
                    <br><small style="color:var(--text-secondary);">（修正目標：利用新資金逐步調整，直至整體比例回到 ${targetA_pct}/${targetB_pct} 範圍為止。）</small>
                `;
            } else {
                const dcaA = dcaAmount * (targetA_pct / 100);
                const dcaB = dcaAmount * (targetB_pct / 100);
                // 輸出結果格式：數值在前，K 美元在後
                dcaMsg = `
                    <strong>【月供建議 - 正常】</strong><br>
                    目前嘅倉位比例健康，建議月供按目標 ${targetA_pct}/${targetB_pct} 比例分配：
                    <br> ➡️ ${assetAName} ${targetA_pct}% (${dcaA.toFixed(2)} K 美元)
                    <br> ➡️ ${assetBName} ${targetB_pct}% (${dcaB.toFixed(2)} K 美元)
                `;
            }
        } else {
            dcaAdvice.className = "dca-advice status-ok";
            dcaMsg = "請輸入 **「每月供款金額 (K 美元)」** 以獲取月供分配建議。";
        }

        dcaAdvice.innerHTML = dcaMsg;
    }
</script>

</body>
</html>
